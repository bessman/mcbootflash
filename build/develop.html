<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Developer’s overview &mdash; mcbootflash 8.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=f663eb4a"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Library API" href="api.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            mcbootflash
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocol.html">Protocol specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Library API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer’s overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tl-dr">Tl;dr</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-style">Code style</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#recording-serial-traffic">Recording serial traffic</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mcbootflash</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Developer’s overview</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/develop.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="developer-s-overview">
<h1>Developer’s overview<a class="headerlink" href="#developer-s-overview" title="Link to this heading"></a></h1>
<section id="tl-dr">
<h2>Tl;dr<a class="headerlink" href="#tl-dr" title="Link to this heading"></a></h2>
<p>Just run <code class="code docutils literal notranslate"><span class="pre">tox</span></code>. If everything passes, you’re OK. If not, read on.</p>
</section>
<section id="code-style">
<h2>Code style<a class="headerlink" href="#code-style" title="Link to this heading"></a></h2>
<p>The mcbootflash authors strive to find as many bugs as possible during the
development stage. For that reason, the following tools are used to enforce
best-practice conventions (default settings unless otherwise noted):</p>
<ul class="simple">
<li><p>black</p></li>
<li><p>isort</p></li>
<li><p>prospector (strictness: veryhigh), which runs the following tools in turn:</p>
<ul>
<li><p>bandit</p></li>
<li><p>dodgy</p></li>
<li><p>mccabe (max-complexity 5)</p></li>
<li><p>pycodestyle (E203 disabled <a class="footnote-reference brackets" href="#e203" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>)</p></li>
<li><p>pydocstyle (numpy style)</p></li>
<li><p>pyflakes</p></li>
<li><p>pylint (W1203 disabled <a class="footnote-reference brackets" href="#w1203" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>)</p></li>
<li><p>mypy (strict)</p></li>
</ul>
</li>
</ul>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="e203" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>pycodestyle E203 conflicts with black, see
<a class="reference external" href="https://github.com/PyCQA/pycodestyle/issues/373">https://github.com/PyCQA/pycodestyle/issues/373</a>.</p>
</aside>
<aside class="footnote brackets" id="w1203" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>See <a class="reference external" href="https://github.com/pylint-dev/pylint/issues/2354">https://github.com/pylint-dev/pylint/issues/2354</a>. Tl;dr:
F-strings in log messages negatively impact performance compared
to %s-style formatting. However, the impact is very small. Because
f-strings are more readable, mcbootflash accepts the performance
hit.</p>
</aside>
</aside>
<p>In addition to these automatically enforced rules, the following conventions are
used:</p>
<ul class="simple">
<li><p>Blank lines before and after code blocks started by a statement (if, while,
return, …) (1), unless the block is only a single line (2), or comes at the
beginning or end of another statement (3).</p></li>
<li><p>Comments and docstrings starts with capital letter and ends with a period,
that is, just as sentences (4).</p></li>
<li><p>Class names are CamelCase. Underscore is not allowed except at the start of
the name to mark the class as private (5).</p></li>
<li><p>Function names are snake_case with underscore separating words. Function
names should be verbs or verb phrases (6).</p></li>
<li><p>Instance variables and variables which are local to a function scope are
snake_case, same as functions (7).</p></li>
<li><p>Module-level variables and class variables are SCREAMING_SNAKE_CASE (8).</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">getcwd</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>

<span class="n">FUM</span> <span class="o">=</span> <span class="mi">0</span>                                            <span class="c1"># (8)</span>


<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>                                         <span class="c1"># (5)</span>
<span class="sd">&quot;&quot;&quot;This is a doc string.&quot;&quot;&quot;</span>                        <span class="c1"># (4)</span>

    <span class="n">BAR</span> <span class="o">=</span> <span class="mi">1</span>                                        <span class="c1"># (8)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fies</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]):</span>           <span class="c1"># (7)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fies</span> <span class="o">=</span> <span class="n">fies</span>


<span class="k">def</span> <span class="nf">eat_ham</span><span class="p">(</span><span class="n">bars</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">goo</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>  <span class="c1"># (6)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a doc string.&quot;&quot;&quot;</span>                    <span class="c1"># (4)</span>

    <span class="n">fies</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ham</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
                                                   <span class="c1"># (1)</span>
    <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>                         <span class="c1"># (3)</span>
            <span class="n">fies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ham</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">bar</span><span class="p">)</span>
                                                   <span class="c1"># (1)</span>
    <span class="c1"># This is a comment.                           # (4)</span>
    <span class="k">if</span> <span class="n">fum</span> <span class="ow">in</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fum</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fum</span> <span class="o">+=</span> <span class="mi">1</span>
                                                   <span class="c1"># (1)</span>
    <span class="n">ham</span> <span class="o">*=</span> <span class="n">fum</span>
    <span class="k">return</span> <span class="n">ham</span>                                     <span class="c1"># (2)</span>
</pre></div>
</div>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading"></a></h2>
<p>When testing software, what should be tested is <em>behavior</em> rather than
<em>implementation</em>. In other words, test <em>what</em> the software does, not <em>how</em> it
does it. In the case of mcbootflash, behavior is the bits that are written to
the serial port, as well as what is done with the bits read from the same.</p>
<p>By testing behavior rather than implementation, we remove the need to update
tests whenever the code changes slightly. Tests only require updating when the
program’s behavior changes, i.e. the data it writes to the serial bus in
response to any given command. If a test fails when you didn’t intend to
change the program’s behavior, you broke something.</p>
<section id="recording-serial-traffic">
<h3>Recording serial traffic<a class="headerlink" href="#recording-serial-traffic" title="Link to this heading"></a></h3>
<p>In order to test mcbootflash’s behavior in isolation, i.e. without a connected
device running an appropriate bootloader, serial traffic is first recorded with
a real device. Then, during tests the recorded traffic is replayed using a
mocked serial port. A test passes if the bits written to and read from the
mocked port match the recorded traffic exactly.</p>
<p>A pytest plugin, <a class="reference external" href="https://github.com/bessman/pytest-reserial">pytest-reserial</a>, is used to record and replay serial traffic.
To create a new test, or update an old one when intentionally changing
mcbootflash’s behavior, run <code class="code docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">--record</span> <span class="pre">-k</span> <span class="pre">&lt;test_name&gt;</span></code> with a device
running the bootloader connected at /dev/ttyUSB0 with a baudrate of 460800
(this port name and baudrate are currently hardcoded during testing; pull
requests welcome if you need them to be dynamic).</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api.html" class="btn btn-neutral float-left" title="Library API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Alexander Bessman.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>